---
layout: post
title: iOS 中深浅拷贝问题
categories: iOS
description: load 和 initialize 的区别
keywords: OC, iOS
---

**浅拷贝**
指针拷贝，复制一个新的指针，指向同一块内存区域。实际内存并没有发生拷贝

**深拷贝**
内容拷贝，拷贝数据到一块新内存区域，指针指向拷贝的数据区

**一个有趣的现象，下面的程序运行后会发生崩溃**

```
    NSMutableString *string = [NSMutableString stringWithFormat:@"name"];
    NSLog(@"原始string的地址:%p",string);
    
    NSMutableString *copyString = [string copy];
    NSLog(@"拷贝string的地址:%p",copyString);
    
    [copyString appendString:@"test"];
```

### 总结
1. copy 出来的字符串一定是不可变字符串，如果传入的是可变字符串，会发生深拷贝为不可变字符串，否则为浅拷贝。

2. mutablecopy，一定是深拷贝，拷贝出来的一定是可变字符串或者数组，即使传入的是不可变字符串或者数组。

### 问题
#### 1.为什么NSString使用copy修饰？
使用copy修饰之后，即使属性拷贝来自可变字符串，也会被深拷贝成不可变字符串，也就是源字符串修改之后不会影响到属性字符串，增强了代码的健壮性。

#### 2.为什么不可变字符串和数组的copy是浅拷贝？
既然数据源本身是不可变的，也就是具备安全性，那么系统默认浅拷贝其中数据，显然是合理的做法。
---
layout: post
title: 解耦套路之 AOP
categories: DesignPatterns
description: 解读那些解耦套路
keywords: AOP
---
AOP（Aspect Oriented Programming）意为：面向切面编程，它是一种在运行时，动态地将代码切入到类的指定方法、指定位置上的编程思想。用于切入到指定类指定方法的代码片段叫做切面，而切入到哪些类中的哪些方法叫做切入点。

### 为什么需要 AOP

假设我们有一个协议`PeoPle`，遵守该协议的类需要提供一个`eat()`方法：
```
protocol People {
    func eat()
}

class European:People {
    func eat() {
    }
}

class Chinese:People {
    func eat() {
    }
}
```

但如果需要在`eat()`方法里进行一些记录，使用面向对象的思路，我们可能会这样做：
```
class Record {
    func log() {
        //do something
    }
}

protocol People {
    func eat()
}

class European:People {
    func eat() {
        let record = Record()
        record.log()
    }
}

class Chinese:People {
    func eat() {
        let record = Record()
        record.log()
    }
}
```

这样做其实已经产生了耦合，每个使用`People`协议的`eat()`方法都要写上记录的代码，当需要记录的信息越来越多时就会变得很臃肿。

或许你会想，我像这样建个基类不就可以了吗？
```
class Record {
    func log() {
        //do something
    }
}

protocol People {
    func eat()
}

class Base:People {
    func eat() {
        let record = Record()
        record.log()
    }
}

class European:Base {
    override func eat() {
    }
}

class Chinese:Base {
    override func eat() {
    }
}
```

理论上需要用 AOP 解决的问题，OOP 也可以解决，但这并非是高效的做法，这样做就需要多维护一个`Base`类，并且如果其他工程需要用到`European`和`Chinese`类，也不方便移植过去。

这个问题的本质是**如何增强对象的方法**，OOP可以解决，但 AOP 更加高效优雅的解决问题。

